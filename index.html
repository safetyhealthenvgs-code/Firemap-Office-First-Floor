<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á‡∏ñ‡∏±‡∏á‡∏î‡∏±‡∏ö‡πÄ‡∏û‡∏•‡∏¥‡∏á</title>

<style>
body { font-family:sans-serif; padding:20px }
h2 { text-align:center }
.filter { text-align:center; margin-bottom:10px }

.map-container{
  position:relative;
  width:100%;
  max-width:873px;
  aspect-ratio:873/600;
  background:url('https://github.com/safetyhealthenvgs-code/Firemap-Office-First-Floor/blob/main/Lay%20out%20Office%20fist%20Floor.jpg?raw=true') no-repeat top left;
  background-size:contain;
  border:1px solid #ccc;
  margin:auto;
}

.marker{
  position:absolute;
  width:12px;height:12px;
  background:red;
  border:2px solid #fff;
  border-radius:50%;
  transform:translate(-50%,-50%);
}

.marker:hover::after{
  content:attr(data-info);
  position:absolute;
  top:-55px; left:50%;
  transform:translateX(-50%);
  background:#000c;
  color:#fff;
  padding:6px 8px;
  font-size:12px;
  border-radius:4px;
  white-space:nowrap;
}
</style>
</head>

<body>

<h2>‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á‡∏ñ‡∏±‡∏á‡∏î‡∏±‡∏ö‡πÄ‡∏û‡∏•‡∏¥‡∏á</h2>

<div class="filter">
  ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:
  <select id="monthFilter"></select>
</div>

<div class="map-container" id="map"></div>

<script>
const SHEET_ID="18YbWGcRIHhxv40v_7NTXQUNL3mV9jnNQrjfcUOvQEQs";
const SHEET_NAME="Zone Office First Floor";

const DATE_COL=1;     // B
const INSPECTOR_COL=2;// C
const NUMBER_COL=3;   // D
const XY_COL=13;      // N

const TH_MONTHS=["‡∏°.‡∏Ñ.","‡∏Å.‡∏û.","‡∏°‡∏µ.‡∏Ñ.","‡πÄ‡∏°.‡∏¢.","‡∏û.‡∏Ñ.","‡∏°‡∏¥.‡∏¢.","‡∏Å.‡∏Ñ.","‡∏™.‡∏Ñ.","‡∏Å.‡∏¢.","‡∏ï.‡∏Ñ.","‡∏û.‡∏¢.","‡∏ò.‡∏Ñ."];

const url=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(SHEET_NAME)}`;

let rows=[];

fetch(url)
.then(r=>r.text())
.then(t=>{
  const json=JSON.parse(t.substring(47).slice(0,-2));
  rows=json.table.rows;
  buildDropdown();
});

function buildDropdown(){
  const map=new Map();

  rows.forEach(r=>{
    const cell=r.c[DATE_COL];
    if(!cell || !cell.v) return;

    // üîë ‡∏à‡∏∏‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: Google ‡∏™‡πà‡∏á Date object ‡∏°‡∏≤
    if(cell.v instanceof Date){
      const y=cell.v.getFullYear();
      const m=cell.v.getMonth();
      const key=`${y}-${m}`;
      const label=`${TH_MONTHS[m]} ${y+543}`;
      map.set(key,label);
    }
  });

  const sel=document.getElementById("monthFilter");
  sel.innerHTML="";

  if(map.size===0){
    sel.innerHTML="<option>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>";
    return;
  }

  [...map.entries()]
    .sort((a,b)=>b[0].localeCompare(a[0]))
    .forEach(([k,v])=>{
      const o=document.createElement("option");
      o.value=k;
      o.textContent=v;
      sel.appendChild(o);
    });

  render(sel.value);
  sel.onchange=()=>render(sel.value);
}

function render(key){
  const map=document.getElementById("map");
  map.innerHTML="";

  rows.forEach(r=>{
    const d=r.c[DATE_COL]?.v;
    if(!(d instanceof Date)) return;

    const k=`${d.getFullYear()}-${d.getMonth()}`;
    if(k!==key) return;

    const xy=r.c[XY_COL]?.v;
    if(!xy||!xy.includes(",")) return;

    const [x,y]=xy.split(",").map(Number);
    if(isNaN(x)||isNaN(y)) return;

    const info=
      `‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à: ${d.toLocaleDateString("th-TH")} \n`+
      `‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ñ‡∏±‡∏á: ${r.c[NUMBER_COL]?.v||""} \n`+
      `‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à: ${r.c[INSPECTOR_COL]?.v||""}`;

    const m=document.createElement("div");
    m.className="marker";
    m.style.left=`${x}%`;
    m.style.top=`${y}%`;
    m.setAttribute("data-info",info);
    map.appendChild(m);
  });
}
</script>

</body>
</html>



